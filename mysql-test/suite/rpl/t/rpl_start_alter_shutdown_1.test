#
# Test SA Crash SA RA Case
#
#
--source include/have_log_bin.inc
--source include/have_innodb.inc
--source include/master-slave.inc
--source include/have_debug.inc

--connection slave
SET @old_debug_slave= @@global.debug;
stop slave;
SET GLOBAL slave_parallel_threads=4;
set global slave_parallel_mode=optimistic;
start slave;

--connection master
SET @old_debug_master= @@global.debug;
set global binlog_split_alter=true;
create table t3( a int primary key, b int) engine=innodb;

--connection master
--sync_slave_with_master
show create table t3;
--connection slave
--source include/stop_slave.inc


--connection master
--exec echo "restart" > $MYSQLTEST_VARDIR/tmp/mysqld.1.expect
SET SESSION debug_dbug="d,start_alter_kill";
--error 2013
alter table t3 add column d int;

--let $rpl_server_number= 1
--source include/rpl_reconnect.inc
set global binlog_split_alter= true;
alter table t3 add column d int;
show create table t3;

--connection slave
--source include/start_slave.inc

--connection master
--sync_slave_with_master


--connection master
SET GLOBAL debug_dbug= @old_debug_master;
#drop table t1,t2,t3;
drop table t3;
set global binlog_split_alter= false;

--sync_slave_with_master
SET GLOBAL debug_dbug= @old_debug_slave;
stop slave;
SET GLOBAL slave_parallel_threads=0;
set global slave_parallel_mode=conservative;
start slave;
--source include/rpl_end.inc
